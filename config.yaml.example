# =============================================================================
# MAMFast Configuration Example
# =============================================================================
# Copy this file to config/config.yaml and adjust for your setup.
# Environment variables in .env override some settings.
# =============================================================================

# ─────────────────────────────────────────────────────────────────────────────
# Environment / Docker
# ─────────────────────────────────────────────────────────────────────────────
environment:
  libation_container: "Libation"      # Docker container name for Libation
  docker_bin: "/usr/bin/docker"       # Path to docker binary
  target_uid: 99                      # UID for created files (99 = nobody on Unraid)
  target_gid: 100                     # GID for created files (100 = users on Unraid)

# ─────────────────────────────────────────────────────────────────────────────
# Paths
# ─────────────────────────────────────────────────────────────────────────────
paths:
  # Libation library directory (where audiobooks are downloaded/stored)
  library_root: "/path/to/your/audiobook/library"

  # Where .torrent files are written
  torrent_output: "/path/to/torrent/files"

  # qBittorrent seed directory - hardlinks created here for seeding
  seed_root: "/path/to/seedvault/audiobooks"

  # State file for tracking processed releases
  state_file: "./data/processed.json"

  # Log file
  log_file: "./logs/mamfast.log"

# ─────────────────────────────────────────────────────────────────────────────
# MAM Compliance
# ─────────────────────────────────────────────────────────────────────────────
mam:
  max_filename_length: 225            # MAM's filename length limit
  allowed_extensions:
    - ".m4b"
    - ".jpg"
    - ".jpeg"
    - ".png"
    - ".pdf"
    - ".cue"

# ─────────────────────────────────────────────────────────────────────────────
# Title Filters
# Note: remove_phrases and author_map have moved to config/naming.json
# ─────────────────────────────────────────────────────────────────────────────
filters:
  # Remove "Book XX" patterns (we keep vol_XX from Libation naming)
  remove_book_numbers: true

  # Use pykakasi to transliterate unknown Japanese text as fallback
  transliterate_japanese: true

# ─────────────────────────────────────────────────────────────────────────────
# Naming / Output Settings
# ─────────────────────────────────────────────────────────────────────────────
naming:
  # Ripper tag appended to folder names: "[H2OKing]" at end of folder name
  # Used in both Audiobookshelf library and MAM uploads (folder only, not filename)
  # Set to null or empty string to disable
  ripper_tag: "H2OKing"

# ─────────────────────────────────────────────────────────────────────────────
# mkbrr Docker Settings
# ─────────────────────────────────────────────────────────────────────────────
mkbrr:
  image: "ghcr.io/autobrr/mkbrr:latest"
  preset: "mam"                       # mkbrr preset name (contains announce URL)

  # Path mapping: how host paths appear inside the mkbrr container
  host_data_root: "/mnt/user/data"
  container_data_root: "/data"

  # mkbrr config directory mapping (where presets.yaml lives)
  host_config_dir: "/path/to/mkbrr/config"
  container_config_dir: "/root/.config/mkbrr"

# ─────────────────────────────────────────────────────────────────────────────
# qBittorrent Settings
# ─────────────────────────────────────────────────────────────────────────────
# Note: Host, username, and password are read from .env file:
#   QB_HOST=http://localhost:8080
#   QB_USERNAME=admin
#   QB_PASSWORD=yourpassword
qbittorrent:
  category: "upload.audiobooks"       # Category for uploaded torrents
  tags:
    - "mamfast"
    - "auto-upload"
  auto_start: true                    # Start seeding immediately after upload
  # Automatic Torrent Management (TMM):
  #   - When true: qBittorrent manages save paths based on category settings
  #   - When false: Uses save_path below for all uploads
  auto_tmm: false
  # Save path as seen by qBittorrent container (only used when auto_tmm is false)
  save_path: "/data/downloads/torrents/qbittorrent/seedvault/audiobooks"

# ─────────────────────────────────────────────────────────────────────────────
# Audnex API (for fetching audiobook metadata)
# ─────────────────────────────────────────────────────────────────────────────
audnex:
  base_url: "https://api.audnex.us"
  timeout_seconds: 30

# ─────────────────────────────────────────────────────────────────────────────
# MediaInfo (for extracting audio file metadata)
# ─────────────────────────────────────────────────────────────────────────────
mediainfo:
  binary: "mediainfo"                 # or full path: /usr/bin/mediainfo

# ─────────────────────────────────────────────────────────────────────────────
# Audiobookshelf Integration (optional)
# ─────────────────────────────────────────────────────────────────────────────
# Note: Host and API token are read from .env file:
#   AUDIOBOOKSHELF_HOST=http://localhost:13378
#   AUDIOBOOKSHELF_API_KEY=your-api-token
audiobookshelf:
  # Enable/disable ABS import integration
  enabled: false

  # Connection timeout
  timeout_seconds: 30

  # Docker path mapping (ABS container path → host path)
  # Required when ABS runs in Docker - paths in API responses are container paths
  # Set docker_mode to false if ABS runs directly on host
  docker_mode: true
  path_map:
    - container: "/audiobooks"
      host: "/path/to/audiobooks"

  # Library configuration (run 'mamfast abs-init' to discover library IDs)
  # Multiple libraries can be defined; only those with mamfast_managed=true are imported
  libraries:
    - id: "lib_xxxxxxxxxxxxx"         # From ABS library ID
      name: "Audiobooks"
      mamfast_managed: true           # Import to this library

  # Import settings
  import:
    # What to do when ASIN already exists in library
    duplicate_policy: skip            # skip | warn | overwrite

    # Trigger ABS library scan after import?
    # none: Don't scan (manual rescan required)
    # each: Scan after each book (slower but immediate)
    # batch: Scan once after all imports complete (recommended)
    trigger_scan: batch

  # Index database location (for ASIN caching and duplicate detection)
  index_db: "./data/abs_index.db"
